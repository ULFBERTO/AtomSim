<app-periodic-table
  *ngIf="showPeriodicTable"
  (elementSelect)="onElementSelect($event)"
  (close)="togglePeriodicTable()">
</app-periodic-table>

<app-molecular-catalog
  *ngIf="showMolecularCatalog"
  [discoveredMolecules]="discoveredMolecules"
  [currentMolecules]="moleculeNames"
  (close)="toggleMolecularCatalog()"
  (recipeSelected)="onRecipeSelected($event)"
  (createReactantsRequested)="onCreateReactants($event)">
</app-molecular-catalog>

<app-tutorial-panel
  [showTutorial]="showTutorial"
  [showExperiments]="showExperiments"
  [showHints]="showHints"
  [activeExperiment]="activeExperiment"
  (tutorialClosed)="closeTutorial()"
  (tutorialCompleted)="completeTutorial()"
  (experimentSelected)="onExperimentSelected($event)"
  (experimentsClosed)="closeExperiments()"
  (hintsToggled)="toggleHints()"
  (loadAtoms)="loadExperimentAtoms($event)">
</app-tutorial-panel>

<!-- Main Control Panel (Left Side) -->
<div class="main-controls">
  <app-control-panel
    [currentMode]="currentSimulationMode"
    [isPaused]="isPaused"
    [simulationSpeed]="simulationSpeed"
    [allowManualBonding]="currentModeConfig.controls.allowManualBonding"
    [bondingMode]="manualBondingMode"
    [canCreateBond]="canCreateManualBond()"
    [selectedAtomCount]="selectedAtomsForBonding.length"
    [showLabels]="showLabels"
    [showElectrons]="showElectrons"
    [showBonds]="showBondsVisual"
    [showGrid]="showGrid"
    [atomCount]="atoms.length"
    [moleculeCount]="molecules.length"
    [bondCount]="bonds.length"
    (modeChanged)="onModeChanged($event)"
    (pauseToggled)="togglePause()"
    (simulationReset)="resetSimulation()"
    (allCleared)="clearAllAtoms()"
    (speedChanged)="onSpeedChanged($event)"
    (periodicTableOpened)="togglePeriodicTable()"
    (experimentsOpened)="toggleExperiments()"
    (tutorialOpened)="openTutorial()"
    (bondingModeToggled)="toggleManualBondingMode()"
    (labelsToggled)="toggleLabels()"
    (electronsToggled)="toggleElectrons()"
    (bondsToggled)="toggleBondsVisual()"
    (gridToggled)="toggleGrid()">
  </app-control-panel>
</div>

<!-- Energy Display (Bottom Left) -->
<div class="energy-display-container">
  <app-energy-display
    [currentEnergy]="transientHeatEnergy"
    [maxEnergy]="100"
    [requiredEnergy]="getRequiredEnergy()"
    [temperature]="calculateTemperature()"
    (energyAdded)="addSystemEnergy($event)"
    (energyReset)="resetSystemEnergy()">
  </app-energy-display>
</div>

<!-- Atom List (Right Side) -->
<div class="atom-list-panel" 
     *ngIf="atoms.length > 0"
     [style.top.px]="panelPositions.atomList.y"
     [style.right.px]="panelPositions.atomList.x"
     [style.left]="'auto'"
     (mousedown)="startDragPanel($event, 'atomList')">
  <div class="drag-handle"></div>
  <div class="panel-header">
    <span>üî¨ √Åtomos en Escena</span>
    <span class="atom-count">{{ atoms.length }}</span>
  </div>
  <div class="atom-list">
    <div *ngFor="let atom of atoms"
         class="atom-list-item"
         (click)="selectAtom(atom)"
         [class.selected]="atom.id === selectedAtom?.id"
         [class.bonding-selected]="isSelectedForBonding(atom)">
      <span class="atom-symbol">{{ getAtomSymbol(atom) }}</span>
      <span class="atom-name">{{ atom.elementName }}</span>
      <button class="delete-btn" (click)="deleteAtomClicked($event, atom)" title="Eliminar">√ó</button>
    </div>
  </div>
</div>

<!-- Molecules Panel -->
<div class="molecules-panel" 
     *ngIf="molecules.length > 0"
     [style.top.px]="panelPositions.molecules.y"
     [style.right.px]="panelPositions.molecules.x"
     [style.left]="'auto'"
     (mousedown)="startDragPanel($event, 'molecules')">
  <div class="drag-handle"></div>
  <div class="panel-header">
    <span>üß¨ Mol√©culas Formadas</span>
    <span class="molecule-count">{{ molecules.length }}</span>
  </div>
  <div class="molecule-list">
    <div *ngFor="let mol of molecules" 
         class="molecule-item"
         (click)="selectMoleculeById(mol.id)"
         [class.selected]="selectedMolecule?.id === mol.id">
      <span class="molecule-name">{{ mol.name }}</span>
      <span class="molecule-atoms">{{ mol.atoms.length }} √°tomos</span>
    </div>
  </div>
</div>

<!-- Selected Atom Info -->
<div class="selected-info" 
     *ngIf="selectedAtom && !selectedAtom.isMoleculeMember"
     [style.bottom.px]="panelPositions.selectedInfo.y"
     [style.right.px]="panelPositions.selectedInfo.x"
     [style.left]="'auto'"
     [style.top]="'auto'"
     (mousedown)="startDragPanel($event, 'selectedInfo')">
  <div class="drag-handle"></div>
  <div class="info-header">
    <span>‚öõÔ∏è {{ selectedAtom.elementName }}</span>
  </div>
  <div class="info-content">
    <div class="info-row">
      <span>Protones:</span>
      <div class="counter">
        <button (click)="removeProton()" [disabled]="selectedAtom.protons <= 1">-</button>
        <span>{{ protons }}</span>
        <button (click)="addProton()">+</button>
      </div>
    </div>
    <div class="info-row">
      <span>Neutrones:</span>
      <div class="counter">
        <button (click)="removeNeutron()" [disabled]="selectedAtom.neutrons <= 0">-</button>
        <span>{{ neutrons }}</span>
        <button (click)="addNeutron()">+</button>
      </div>
    </div>
    <div class="info-row">
      <span>Electrones:</span>
      <div class="counter">
        <button (click)="removeElectron()" [disabled]="electronsCount <= 0">-</button>
        <span>{{ electronsCount }}</span>
        <button (click)="addElectron()">+</button>
      </div>
    </div>
  </div>
</div>

<!-- Notification Toast -->
<div class="notification-toast" *ngIf="notification" [class]="notification.type">
  <span class="notification-icon">{{ getNotificationIcon() }}</span>
  <span class="notification-message">{{ notification.message }}</span>
</div>

<!-- Pause Overlay -->
<div class="pause-overlay" *ngIf="isPaused">
  <div class="pause-content">
    <span class="pause-icon">‚è∏Ô∏è</span>
    <span class="pause-text">PAUSADO</span>
    <p class="pause-hint">Puedes mover √°tomos y crear enlaces mientras est√° pausado</p>
  </div>
</div>

<!-- Canvas -->
<canvas #simulationCanvas></canvas>
